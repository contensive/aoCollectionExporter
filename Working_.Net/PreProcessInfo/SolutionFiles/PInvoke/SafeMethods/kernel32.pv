(%unit (%imports (%import "System.Runtime.InteropServices") (%import "System")) (%package "UpgradeSolution1Support.PInvoke.SafeNative" (%class "kernel32" (%public) (%static) (%method "CopyMemory" (%void) (%args (%variable (%byref) (%var "hpvDest") (%int)) (%variable (%byref) (%var "hpvSource") (%byte)) (%variable (%byval) (%var "cbCopy") (%int))) (%seq (%variable (%var "handle" (%init-value (%call (%id "GCHandle.Alloc") (%param (%id "hpvDest") (%id "GCHandleType.Pinned"))))) (%user-type "GCHandle")) (%variable (%var "handle2" (%init-value (%call (%id "GCHandle.Alloc") (%param (%id "hpvSource") (%id "GCHandleType.Pinned"))))) (%user-type "GCHandle")) (%try (%seq (%variable (%var "tmpPtr2" (%init-value (%call (%dot (%id "handle2") (%id "AddrOfPinnedObject")) (%param)))) (%user-type "IntPtr")) (%variable (%var "tmpPtr" (%init-value (%call (%dot (%id "handle") (%id "AddrOfPinnedObject")) (%param)))) (%user-type "IntPtr")) (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.CopyMemory") (%param (%id "tmpPtr") (%id "tmpPtr2") (%id "cbCopy"))) (%= (%id "hpvSource") (%call (%id "Marshal.ReadByte") (%param (%id "tmpPtr2")))) (%= (%id "hpvDest") (%call (%id "Marshal.ReadInt32") (%param (%id "tmpPtr"))))) (%finally (%seq (%call (%dot (%id "handle") (%id "Free")) (%param)) (%call (%dot (%id "handle2") (%id "Free")) (%param)))))) (%public) (%shared)) (%method "CopyMemory" (%void) (%args (%variable (%byref) (%var "hpvDest") (%byte)) (%variable (%byval) (%var "hpvSource") (%int)) (%variable (%byval) (%var "cbCopy") (%int))) (%seq (%variable (%var "handle" (%init-value (%call (%id "GCHandle.Alloc") (%param (%id "hpvDest") (%id "GCHandleType.Pinned"))))) (%user-type "GCHandle")) (%variable (%var "handle2" (%init-value (%call (%id "GCHandle.Alloc") (%param (%id "hpvSource") (%id "GCHandleType.Pinned"))))) (%user-type "GCHandle")) (%try (%seq (%variable (%var "tmpPtr2" (%init-value (%call (%dot (%id "handle2") (%id "AddrOfPinnedObject")) (%param)))) (%user-type "IntPtr")) (%variable (%var "tmpPtr" (%init-value (%call (%dot (%id "handle") (%id "AddrOfPinnedObject")) (%param)))) (%user-type "IntPtr")) (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.CopyMemory") (%param (%id "tmpPtr") (%id "tmpPtr2") (%id "cbCopy"))) (%= (%id "hpvSource") (%call (%id "Marshal.ReadInt32") (%param (%id "tmpPtr2")))) (%= (%id "hpvDest") (%call (%id "Marshal.ReadByte") (%param (%id "tmpPtr"))))) (%finally (%seq (%call (%dot (%id "handle") (%id "Free")) (%param)) (%call (%dot (%id "handle2") (%id "Free")) (%param)))))) (%public) (%shared)) (%method "GetCurrentProcess" (%int) (%args) (%seq (%return (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.GetCurrentProcess") (%param)))) (%public) (%shared)) (%method "GetCurrentProcessId" (%int) (%args) (%seq (%return (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.GetCurrentProcessId") (%param)))) (%public) (%shared)) (%method "SetPriorityClass" (%int) (%args (%variable (%byval) (%var "hProcess") (%int)) (%variable (%byval) (%var "dwPriorityClass") (%int))) (%seq (%return (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.SetPriorityClass") (%param (%id "hProcess") (%id "dwPriorityClass"))))) (%public) (%shared)) (%method "Sleep" (%void) (%args (%variable (%byval) (%var "dwMilliseconds") (%int))) (%seq (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.Sleep") (%param (%id "dwMilliseconds")))) (%public) (%shared)) (%method "WideCharToMultiByte" (%int) (%args (%variable (%byval) (%var "CodePage") (%int)) (%variable (%byval) (%var "dwFlags") (%int)) (%variable (%byval) (%var "lpWideCharStr") (%int)) (%variable (%byval) (%var "cchWideChar") (%int)) (%variable (%byval) (%var "lpMultiByteStr") (%int)) (%variable (%byval) (%var "cbMultiByte") (%int)) (%variable (%byval) (%var "lpDefaultChar") (%int)) (%variable (%byval) (%var "lpUsedDefaultChar") (%int))) (%seq (%return (%call (%id "UpgradeSolution1Support.PInvoke.UnsafeNative.kernel32.WideCharToMultiByte") (%param (%id "CodePage") (%id "dwFlags") (%id "lpWideCharStr") (%id "cchWideChar") (%id "lpMultiByteStr") (%id "cbMultiByte") (%id "lpDefaultChar") (%id "lpUsedDefaultChar"))))) (%public) (%shared)))))